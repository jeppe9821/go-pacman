package pacman

import (
	_ "embed"

	"github.com/jeppe9821/go-pacman/audio"
	"github.com/jeppe9821/go-pacman/pacman/pacactor"
	"github.com/jeppe9821/go-pacman/pacman/pacmap"
	"github.com/jeppe9821/go-pacman/pacman/pacmath"
	"github.com/jeppe9821/go-pacman/render"
)

type Pacman struct {
	tileMap        World
	beginningAudio *audio.WavStream
	moveAudio      *audio.WavStream
	spritesheet    render.Spritesheet8Bit
}

func Create() Pacman {
	grid := [31][28]uint8{ //28x31
		{2, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 44, 43, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 1},
		{4, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 26, 25, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 3},
		{4, 45, 24, 16, 16, 23, 45, 24, 16, 16, 16, 23, 45, 26, 25, 45, 24, 16, 16, 16, 23, 45, 24, 16, 16, 23, 45, 3},
		{4, 45, 26, 0, 0, 25, 45, 26, 0, 0, 0, 25, 45, 26, 25, 45, 26, 0, 0, 0, 25, 45, 26, 0, 0, 25, 45, 3},
		{4, 45, 28, 21, 21, 27, 45, 28, 21, 21, 21, 27, 45, 42, 41, 45, 28, 21, 21, 21, 27, 45, 28, 21, 21, 27, 45, 3},
		{4, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 3},
		{4, 45, 24, 16, 16, 23, 45, 24, 23, 45, 24, 16, 16, 16, 16, 16, 16, 23, 45, 24, 23, 45, 24, 16, 16, 23, 45, 3},
		{4, 45, 28, 21, 21, 27, 45, 26, 25, 45, 28, 21, 21, 36, 35, 21, 21, 27, 45, 26, 25, 45, 28, 21, 21, 27, 45, 3},
		{4, 45, 45, 45, 45, 45, 45, 26, 25, 45, 45, 45, 45, 26, 25, 45, 45, 45, 45, 26, 25, 45, 45, 45, 45, 45, 45, 3},
		{6, 14, 14, 14, 14, 23, 45, 26, 37, 16, 16, 23, 45, 26, 25, 45, 24, 16, 16, 38, 25, 45, 24, 13, 13, 13, 13, 5},
		{0, 0, 0, 0, 0, 4, 45, 26, 35, 21, 21, 27, 45, 28, 27, 45, 28, 21, 21, 36, 25, 45, 3, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 4, 45, 26, 25, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 26, 25, 45, 3, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 4, 45, 26, 25, 45, 30, 14, 34, 0, 0, 33, 14, 29, 45, 26, 25, 45, 3, 0, 0, 0, 0, 0},
		{12, 12, 12, 12, 12, 27, 45, 28, 27, 45, 3, 0, 0, 0, 0, 0, 0, 4, 45, 28, 27, 45, 28, 11, 11, 11, 11, 11},
		{45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 3, 0, 0, 0, 0, 0, 0, 4, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45},
		{14, 14, 14, 14, 14, 23, 45, 24, 23, 45, 3, 0, 0, 0, 0, 0, 0, 4, 45, 24, 23, 45, 24, 13, 13, 13, 13, 13},
		{0, 0, 0, 0, 0, 4, 45, 26, 25, 45, 32, 12, 12, 12, 12, 12, 12, 31, 45, 26, 25, 45, 3, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 4, 45, 26, 25, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 26, 25, 45, 3, 0, 0, 0, 0, 0},
		{0, 0, 0, 0, 0, 4, 45, 26, 25, 45, 24, 16, 16, 16, 16, 16, 16, 23, 45, 26, 25, 45, 3, 0, 0, 0, 0, 0},
		{2, 12, 12, 12, 12, 27, 45, 28, 27, 45, 28, 21, 21, 36, 35, 21, 21, 27, 45, 28, 27, 45, 28, 11, 11, 11, 11, 1},
		{4, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 26, 25, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 3},
		{4, 45, 24, 16, 16, 23, 45, 24, 16, 16, 16, 23, 45, 26, 25, 45, 24, 16, 16, 16, 23, 45, 24, 16, 16, 23, 45, 3},
		{4, 45, 28, 21, 23, 25, 45, 28, 21, 21, 21, 27, 45, 28, 27, 45, 28, 21, 21, 21, 27, 45, 26, 35, 21, 27, 45, 3},
		{4, 45, 45, 45, 26, 25, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 26, 25, 45, 45, 45, 3},
		{8, 16, 23, 45, 26, 25, 45, 24, 23, 45, 24, 16, 16, 16, 16, 16, 16, 23, 45, 24, 23, 45, 26, 25, 45, 24, 16, 7},
		{10, 21, 27, 45, 28, 27, 45, 26, 25, 45, 28, 21, 21, 36, 35, 21, 21, 27, 45, 26, 25, 45, 28, 27, 45, 28, 21, 9},
		{4, 45, 45, 45, 45, 45, 45, 26, 25, 45, 45, 45, 45, 26, 25, 45, 45, 45, 45, 26, 25, 45, 45, 45, 45, 45, 45, 3},
		{4, 45, 24, 16, 16, 16, 16, 38, 37, 16, 16, 23, 45, 26, 25, 45, 24, 16, 16, 38, 37, 16, 16, 16, 16, 23, 45, 3},
		{4, 45, 28, 21, 21, 21, 21, 21, 21, 21, 21, 27, 45, 28, 27, 45, 28, 21, 21, 21, 21, 21, 21, 21, 21, 27, 45, 3},
		{4, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 3},
		{6, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 5},
	}

	return Pacman{
		beginningAudio: audio.CreateWavStream("assets/sound/pacman_beginning.wav"),
		moveAudio:      audio.CreateWavStream("assets/sound/pacman_waka.wav"),
		tileMap: World{
			player: pacactor.CreateActor(pacmath.TilePosition{X: 23, Y: 23}, &pacactor.PlayerBehaviour{
				AnimationBehaviour: pacactor.CreateNewAnimationBehaviour(0, 2, 8),
			}),
			blinky:  pacactor.CreateActor(pacmath.TilePosition{X: 13, Y: 23}, &pacactor.BlinkyChaseBehaviour{}),
			TileMap: pacmap.TileMap{Grid: grid},
		},
		spritesheet: render.LoadFromFile("assets/spritesheet.png"),
	}
}

func (pacman Pacman) Update(tick int) {
	pacman.beginningAudio.Play()
	pacman.tileMap.Update(tick)
}

func (pacman Pacman) Draw(screen render.Screen) {
	pacman.tileMap.Draw(screen, pacman.spritesheet)
}
